{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Storage</title>
    
    <!--
      PART 1: STYLES & FONTS
      Here we load Bootstrap (for layout), Bootstrap Icons (for visuals), 
      and a Google Font (Inter) for a clean, modern look.
    -->

    <!-- Reset CSS -->
    <link rel = stylesheet href = "{% static 'reset.css' %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <!-- Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel = stylesheet href = "{% static 'styles.css' %}">
</head>
<body>

    <!-- 
      PART 3: NAVIGATION BAR
      This is the main header for the site. It's 'sticky' so it stays at the top.
      The links inside change based on whether the user is logged in, and
      what their role is (Renter vs. Lessee).
    -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="bi bi-box-seam-fill"></i> Project Storage</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">     
                    {% if user.is_authenticated %}
                    {% if user.role == 'LESSEE' %}
                    <!-- Lessee Users -->
                    <li class="nav-item lessee-only">
                        <a class="nav-link active" href = "{% url 'search_space' %}"><i class="bi bi-search"></i> Search Spaces</a>
                    </li>
                    <li class="nav-item lessee-only">
                        <a class="nav-link" href = "{% url 'dashboard'%}"><i class="bi bi-calendar-check"></i> My Bookings</a>
                    </li>
                    {% endif %}
                    
                    {% if user.role == 'RENTER' %}
                    <!-- Renter Users -->
                    <li class="nav-item renter-only">
                        <a class="nav-link" href = "{% url 'dashboard'%}"><i class="bi bi-grid-3x3-gap"></i> My Spaces</a>
                    </li>
                    <li class="nav-item renter-only">
                        <a class="nav-link" href = "{% url 'installation_request_list'%}"><i class="bi bi-grid-3x3-gap"></i> My Requests</a>
                    </li>
                    {% endif %}

                    {% if user.is_superuser %}
                    <li class="nav-item admin-only">
                        <a class="nav-link" href="{% url 'admin_space_list' %}"><i class="bi bi-shield-check"></i> Space List</a>
                    </li>
                    <li class="nav-item admin-only">
                        <a class="nav-link" href="{% url 'admin_installation_request_list' %}"><i class="bi bi-shield-check"></i> Request Queue</a>
                    </li>
                    {% endif %}

                    <!-- All Authenticated Users -->
                    <li class="nav-item dropdown authenticated-only">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarUserMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle"></i> <span id="nav-user-email">
                              {{user.get_short_name}}
                            </span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarUserMenu">
                            <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                        <!--
                            <li>
                              <a class="dropdown-item text-danger" href="{% url 'logout' %}" id="logout-button">Logout</a>
                              <form id="logout-form" action="{% url 'logout' %}" method="post" style="display:none;">
                                {% csrf_token %}
                              </form>
                            </li>
                          -->
                            <li>
                              <form action="{% url 'logout' %}" method="post" class="d-inline" style="margin:0;">
                                {% csrf_token %}
                                <button type="submit" class="dropdown-item text-danger">
                                  Logout
                                </button>
                              </form>
                            </li>
                        </ul>
                    </li>

                    {% else %}
                    <!-- Unauthenticated Users -->
                    <li class="nav-item unauthenticated-only">
                        <a class="nav-link" href = "{% url 'login' %}">Login</a>
                    </li>
                    <li class="nav-item unauthenticated-only">
                        <a class="btn btn-accent btn-sm" href = "{% url 'signup' %}">Sign Up</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- 
      PART 4: MAIN CONTENT AREA
      This container holds all the different "pages" of our app.
      The JavaScript will show/hide these .page divs based on the URL hash.
    -->
    <main class="container my-4 my-md-5">
      {% block content %}
      {% endblock %}

        <!-- 
          PAGE 1: Login (Day 1)
          A simple login form.
        -->

        <!-- 
          PAGE 2: Sign Up
        -->
        
        <!-- 
          PAGE 3: Renter - Create Space
        -->

        <!-- 
          PAGE 4: Lessee - Search
        -->
        
        <!-- 
          PAGE 5: Lessee - Booking Form
        -->
        
        <!-- 
          PAGE 6: Lessee Dashboard
        -->
        
        <!-- 
          PAGE 7: Renter Dashboard
        -->
        
        <!-- 
          PAGE 8: Profile Page
          Shows the user's details.
        
        <div id="page-profile" class="page">
            <h2 class="mb-4">My Profile</h2>
             <div class="card auth-card">
                 <div class="card-body p-4 p-md-5">
                    <h4 class="card-title">User Details</h4>
                    <hr>
                    <p><strong>Email:</strong> <span id="profile-email"></span></p>
                    <p><strong>Role:</strong> <span id="profile-role" class="badge bg-primary"></span></p>
                    <p><strong>NRIC/FIN:</strong> <span id="profile-nric"></span></p>
                    <hr>
                    <p class="text-muted small">Role changes must be approved by an administrator. Please contact support to make changes.</p>
                 </div>
             </div>
        </div>
        -->

    </main>

    {% block modals %}
    {% endblock %}

    <!-- 
      PART 5: JAVASCRIPT
      This includes Bootstrap's JS and our custom application logic.
    -->

    <!-- Bootstrap JS Bundle (Popper.js included) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Vanilla JavaScript Application Logic -->
    <script src = "{% static 'script.js' %}"></script>
</body>
</html>

